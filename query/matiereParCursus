xquery version "3.0";
<cursuses>
    {let $matieres := doc("Matieres.xml")
    let $cursuses := distinct-values($matieres//cursus)
    for $cursus in $cursuses
    return 
        <cursus>
            <nom>{$cursus}</nom>
            <matiere>{for $matieresCursus in doc("Matieres.xml")//matiere
            where some $matCurs in $matieresCursus/cursusApp/cursus/string() satisfies $matCurs = $cursus
            return $matieresCursus/nom}</matiere>
        </cursus>}
</cursuses>